var PO=function(){function n(e){return t.test(e.className)}function r(e){var t,n;e||(n=window.event);if(e.button===0||n.which===1)return!0}function i(){try{return localStorage.setItem("check",!0),localStorage.removeItem("check"),!0}catch(e){return!1}}var e={dragArea:"#dragArea",dragItemSel:".draggable"},t=new RegExp("dragging","ig");return{bindMouseEvents:function(){var e=this;e.draggables.on({mousedown:function(t){if(r(t)){var n=this;t.preventDefault(),e.index=e.placeholderIndex=e.draggables.index(this),e.startDrag(t,this),$(document).on({mouseup:function(t){t.preventDefault(),e.stopDrag(t,n)},mousemove:function(t){e.dragging&&e.drag(t,n)}})}}})},setItems:function(){var e={id:[]};this.draggables.each(function(t){e.id.push(this.id)}),localStorage.setItem("photoOrder",JSON.stringify(e))},getItems:function(e){return localStorage.getItem(e)},insertPlaceholder:function(e){var t=document.createElement(e.nodeName);t.className=e.className+" placeholder",t.style.height=e.offsetHeight+"px",t.style.width=e.offsetWidth+"px",$(e).after(t),this.placeholder=$(t)},movePlaceholder:function(e,t){t==="before"?$(".placeholder").insertBefore(e):t==="after"&&$(".placeholder").insertAfter(e)},removePlaceholder:function(){$(".placeholder").remove()},startDrag:function(e,t){this.startX=e.pageX,this.startY=e.pageY,this.elStartX=$(t).position().left,this.elStartY=$(t).position().top,this.dragging=!0,n(t)||(this.insertPlaceholder(t),t.style.top=this.elStartY+"px",t.style.left=this.elStartX+"px",t.className+=" dragging")},stopDrag:function(e,t){var n=this,r=this.placeholder.position();this.dragging=!1,$(t).animate({top:r.top,left:r.left},{duration:250,complete:function(){n.putDragger(this)}}),$(document).off("mousemove"),$(document).off("mouseup")},putDragger:function(e){$(e).removeClass("dragging").insertBefore(this.placeholder),this.removePlaceholder(),e.style.left="",e.style.top="",this.draggables=this.getDraggables(),this.canStore&&this.setItems()},constructQuadrants:function(e){return{xStart:this.positions[e].x,yStart:this.positions[e].y,xEnd:this.positions[e].x+this.draggables[e].offsetWidth,yEnd:this.positions[e].y+this.draggables[e].offsetWidth}},findNewPos:function(e,t){var n,r,i,s;r=this.positions.length;for(n=0;n<r;n++)s=this.constructQuadrants(n),e>s.xStart&&t>s.yStart&&e<s.xEnd&&t<s.yEnd&&(this.placeholderIndex<n?i="after":i="before",this.movePlaceholder(this.draggables[n],i))},drag:function(e,t){var r,i;n(t)&&(r=e.pageX-this.startX+this.elStartX,i=e.pageY-this.startY+this.elStartY,this.findNewPos(e.pageX,e.pageY),t.style.left=r+"px",t.style.top=i+"px")},getDraggables:function(){return $(this.opts.dragItemSel)},getDraggalbePositions:function(){var e=this,t,n=[];return this.draggables.each(function(){this.className.match(/(dragging|placeholder)/)||(t=$(this).offset(),n.push({x:t.left,y:t.top}))}),n},setOrder:function(){var e=JSON.parse(this.getItems("photoOrder"))||!1,t,n,r,i,s;if(e){s=$(this.opts.dragArea),n=e.id.length;for(i=0;i<n;i++)r=$("#"+e.id[i]).detach(),s.append(r)}},init:function(t){var n=this;this.opts=$.extend({},t,e),this.canStore=i(),this.canStore&&this.setOrder(),this.draggables=this.getDraggables(),this.positions=this.getDraggalbePositions(),this.dragging=!1,this.bindMouseEvents()}}}()